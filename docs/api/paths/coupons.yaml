/coupons/issue:
  post:
    tags:
      - Coupon
    summary: 쿠폰 발급
    description: |
      선착순 제한 수량 쿠폰을 발급받습니다.

      **기능 요구사항**: FR-CP-001
      **관련 문서**: docs/requirements/coupon.md

      **비즈니스 규칙**:
      - 1인 1쿠폰 (동일 타입)
      - 선착순 발급 (제한 수량)
      - 이미 발급받은 쿠폰은 재발급 불가
      - 수량 소진 시 발급 불가

      **처리 순서**:
      1. 쿠폰 타입 존재 여부 확인
      2. 중복 발급 확인
      3. 잔여 수량 확인 (락 획득)
      4. 발급 수량 증가
      5. 사용자 쿠폰 생성
    operationId: issueCoupon
    parameters:
      - name: userId
        in: query
        description: 사용자 ID
        required: true
        schema:
          type: integer
          example: 1
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/coupon.yaml#/components/schemas/IssueCouponRequest'
          example:
            couponTypeId: 1
    responses:
      '201':
        description: 발급 성공
        content:
          application/json:
            schema:
              $ref: '../schemas/coupon.yaml#/components/schemas/IssueCouponResponse'
      '400':
        description: 잘못된 요청
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/components/schemas/Error'
            examples:
              couponAlreadyIssued:
                summary: 이미 발급받은 쿠폰
                value:
                  code: "COUPON_ALREADY_ISSUED"
                  message: "이미 발급받은 쿠폰입니다"
              couponSoldOut:
                summary: 쿠폰 소진
                value:
                  code: "COUPON_SOLD_OUT"
                  message: "쿠폰이 모두 소진되었습니다"
      '404':
        description: 쿠폰 타입을 찾을 수 없음
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/components/schemas/Error'
            example:
              code: "COUPON_TYPE_NOT_FOUND"
              message: "쿠폰을 찾을 수 없습니다"
      '500':
        description: 서버 오류

/coupons/my:
  get:
    tags:
      - Coupon
    summary: 내 쿠폰 목록 조회
    description: |
      사용자가 보유한 쿠폰 목록을 조회합니다.

      **기능 요구사항**: FR-CP-002
      **관련 문서**: docs/requirements/coupon.md

      **비즈니스 규칙**:
      - 만료되지 않은 쿠폰과 만료된 쿠폰 모두 조회
      - 상태별 필터링 가능 (AVAILABLE, USED)
    operationId: getMyCoupons
    parameters:
      - name: userId
        in: query
        description: 사용자 ID
        required: true
        schema:
          type: integer
          example: 1
      - name: status
        in: query
        description: 쿠폰 상태 필터
        required: false
        schema:
          $ref: '../schemas/coupon.yaml#/components/schemas/CouponStatus'
    responses:
      '200':
        description: 조회 성공
        content:
          application/json:
            schema:
              $ref: '../schemas/coupon.yaml#/components/schemas/UserCouponListResponse'
      '500':
        description: 서버 오류

/coupons/{couponId}:
  get:
    tags:
      - Coupon
    summary: 쿠폰 상세 조회
    description: |
      특정 쿠폰의 상세 정보를 조회합니다.

      **기능 요구사항**: FR-CP-003
      **관련 문서**: docs/requirements/coupon.md
    operationId: getCoupon
    parameters:
      - name: userId
        in: query
        description: 사용자 ID
        required: true
        schema:
          type: integer
          example: 1
      - name: couponId
        in: path
        description: 사용자 쿠폰 ID
        required: true
        schema:
          type: integer
          example: 101
    responses:
      '200':
        description: 조회 성공
        content:
          application/json:
            schema:
              $ref: '../schemas/coupon.yaml#/components/schemas/UserCoupon'
      '404':
        description: 쿠폰을 찾을 수 없음
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/components/schemas/Error'
            example:
              code: "COUPON_NOT_FOUND"
              message: "쿠폰을 찾을 수 없습니다"
      '403':
        description: 다른 사용자의 쿠폰
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/components/schemas/Error'
            example:
              code: "FORBIDDEN"
              message: "다른 사용자의 쿠폰입니다"
      '500':
        description: 서버 오류

/coupons/types:
  get:
    tags:
      - Coupon
    summary: 발급 가능한 쿠폰 타입 목록 조회
    description: |
      현재 발급 가능한 쿠폰 타입 목록을 조회합니다.

      **기능 요구사항**: FR-CP-004
      **관련 문서**: docs/requirements/coupon.md

      **비즈니스 규칙**:
      - 유효 기간 내의 쿠폰만 조회
      - 수량이 남아있는 쿠폰만 조회
      - 이미 발급받은 쿠폰 타입은 제외 가능
    operationId: getCouponTypes
    parameters:
      - name: userId
        in: query
        description: 사용자 ID (excludeOwned=true인 경우 필수)
        required: false
        schema:
          type: integer
          example: 1
      - name: excludeOwned
        in: query
        description: 이미 발급받은 쿠폰 제외 여부
        required: false
        schema:
          type: boolean
          default: false
    responses:
      '200':
        description: 조회 성공
        content:
          application/json:
            schema:
              $ref: '../schemas/coupon.yaml#/components/schemas/CouponTypeListResponse'
      '500':
        description: 서버 오류
